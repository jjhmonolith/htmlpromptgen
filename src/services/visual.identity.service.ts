import { OpenAIService } from './openai.service';
import { loadApiKey } from './storage.service';
import { ProjectData, VisualIdentity } from '../types/workflow.types';

export class VisualIdentityService {
  private openaiService = OpenAIService.getInstance();

  async generateVisualIdentity(projectData: ProjectData): Promise<VisualIdentity> {
    // API í‚¤ í™•ì¸ ë° OpenAI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
    const apiKey = loadApiKey();
    if (!apiKey) {
      throw new Error('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
    }

    // OpenAI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
    this.openaiService.initialize(apiKey);
    
    const client = this.openaiService.getClient();
    
    const prompt = this.buildPrompt(projectData);
    
    try {
      const response = await client.chat.completions.create({
        model: 'gpt-4o',
        messages: [
          {
            role: 'system',
            content: 'ë‹¹ì‹ ì€ êµìœ¡ ì½˜í…ì¸  ë””ìžì¸ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤. ì‚¬ìš©ìžì˜ ìš”ì²­ì— ë”°ë¼ ë¹„ì£¼ì–¼ ì•„ì´ë´í‹°í‹°ë¥¼ ì„¤ê³„í•˜ê³  JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.'
          },
          {
            role: 'user',
            content: prompt
          }
        ],
        temperature: 0.7,
        max_tokens: 8000
      });

      const content = response.choices[0]?.message?.content;
      if (!content) {
        throw new Error('AI ì‘ë‹µì´ ë¹„ì–´ìžˆìŠµë‹ˆë‹¤.');
      }

      // JSON ì‘ë‹µ íŒŒì‹±
      const jsonMatch = content.match(/\{[\s\S]*\}/);
      if (!jsonMatch) {
        throw new Error('ìœ íš¨í•œ JSON ì‘ë‹µì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      const aiResponse = JSON.parse(jsonMatch[0]);
      
      // VisualIdentity íƒ€ìž…ìœ¼ë¡œ ë³€í™˜
      const visualIdentity: VisualIdentity = {
        primaryColor: aiResponse.colorPalette?.primary || '#3e88ff',
        secondaryColor: aiResponse.colorPalette?.secondary || '#10B981',
        accentColor: aiResponse.colorPalette?.accent || '#FBBF24',
        fontFamily: aiResponse.typography?.headingFont || 'Pretendard, system-ui, sans-serif',
        fontSize: aiResponse.typography?.baseSize || '18px',
        tone: this.mapToneFromMood(aiResponse.moodAndTone),
        moodBoard: aiResponse.moodAndTone || 'ì¹œê·¼í•œ, í™œê¸°ì°¬, ëª…ë£Œí•œ, í˜„ëŒ€ì ì¸',
        colorPalette: {
          primary: aiResponse.colorPalette?.primary || '#3e88ff',
          secondary: aiResponse.colorPalette?.secondary || '#10B981',
          accent: aiResponse.colorPalette?.accent || '#FBBF24',
          text: aiResponse.colorPalette?.text || '#1F2937',
          background: aiResponse.colorPalette?.background || '#FFFFFF'
        },
        typography: {
          headingFont: aiResponse.typography?.headingFont || 'Pretendard, system-ui, sans-serif',
          bodyFont: aiResponse.typography?.bodyFont || 'Pretendard, system-ui, sans-serif',
          baseSize: aiResponse.typography?.baseSize || '18px'
        },
        moodAndTone: aiResponse.moodAndTone || 'ì¹œê·¼í•œ, í™œê¸°ì°¬, ëª…ë£Œí•œ, í˜„ëŒ€ì ì¸',
        componentStyle: aiResponse.componentStyle || 'ë²„íŠ¼ì€ ë‘¥ê·¼ ëª¨ì„œë¦¬ì™€ ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ìžë¥¼ ì‚¬ìš©í•˜ë©°, ì¹´ë“œëŠ” ê¹”ë”í•œ ì—¬ë°±ê³¼ ë¯¸ë‹ˆë©€í•œ ë””ìžì¸ì„ ì ìš©í•©ë‹ˆë‹¤.'
      };

      return visualIdentity;

    } catch (error) {
      console.error('ë¹„ì£¼ì–¼ ì•„ì´ë´í‹°í‹° ìƒì„± ì‹¤íŒ¨:', error);
      throw new Error(`ë¹„ì£¼ì–¼ ì•„ì´ë´í‹°í‹° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
    }
  }

  private buildPrompt(projectData: ProjectData): string {
    if (projectData.layoutMode === 'scrollable') {
      return this.buildScrollablePrompt(projectData);
    } else {
      return this.buildFixedPrompt(projectData);
    }
  }

  private buildScrollablePrompt(projectData: ProjectData): string {
    return `
ë‹¹ì‹ ì€ êµìœ¡ ì½˜í…ì¸  ë””ìžì¸ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤. 
ðŸ“œ **ìŠ¤í¬ë¡¤ ê°€ëŠ¥ ë ˆì´ì•„ì›ƒ**ì„ ìœ„í•œ ë¹„ì£¼ì–¼ ì•„ì´ë´í‹°í‹°ë¥¼ ë””ìžì¸í•´ì£¼ì„¸ìš”.

## í”„ë¡œì íŠ¸ ì •ë³´
- í”„ë¡œì íŠ¸ëª…: ${projectData.projectTitle}
- ëŒ€ìƒ í•™ìŠµìž: ${projectData.targetAudience}
- íŽ˜ì´ì§€ ì£¼ì œ: ${projectData.pages.map(p => p.topic).join(', ')}
- ì½˜í…ì¸  ëª¨ë“œ: ${projectData.contentMode === 'enhanced' ? 'AI ë³´ê°•' : 'ì›ë³¸ ìœ ì§€'}
- ì‚¬ìš©ìž ì œì•ˆ: ${projectData.suggestions || 'ì—†ìŒ'}

## ðŸ“œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ ë ˆì´ì•„ì›ƒ ì „ìš© ë””ìžì¸ ì›ì¹™

**ì½˜í…ì¸  ìš°ì„  ì ‘ê·¼ìœ¼ë¡œ ìžì—°ìŠ¤ëŸ¬ìš´ íë¦„ì„ ë§Œë“­ë‹ˆë‹¤.**

### 1. ê°€ë…ì„± ìµœìš°ì„  ì»¬ëŸ¬ ì‹œìŠ¤í…œ
- **ë°°ê²½ ëŒ€ë¹„ í…ìŠ¤íŠ¸**: ìµœì†Œ 7:1 ëŒ€ë¹„ìœ¨ë¡œ ìž¥ì‹œê°„ ì½ê¸°ì— ìµœì í™”
- **ì œëª© ê°•ì¡° ìƒ‰ìƒ**: ë°°ê²½ê³¼ ì¶©ë¶„í•œ ëŒ€ë¹„ë¡œ ì„¹ì…˜ êµ¬ë¶„ ëª…í™•
- **ëˆˆì˜ í”¼ë¡œê° ë°©ì§€**: ë¶€ë“œëŸ¬ìš´ ìƒ‰ì¡°ë¡œ ê¸´ ìŠ¤í¬ë¡¤ì—ì„œë„ íŽ¸ì•ˆí•¨
- **ìƒ‰ìƒ ê³„ì¸µ êµ¬ì¡°**: Primary(ë©”ì¸) â†’ Secondary(ë³´ì¡°) â†’ Accent(ê°•ì¡°) ìˆœì„œë¡œ ì‹œê°ì  íë¦„ ìœ ë„

### 2. í”„ë¡œì íŠ¸ ë§žì¶¤í˜• ë””ìžì¸ ë¶„ìœ„ê¸°
#### ëŒ€ìƒë³„ íŠ¹í™”:
- **ì–´ë¦°ì´ ëŒ€ìƒ**: ë°ê³  ì¹œê·¼í•œ ìƒ‰ìƒ, ë¶€ë“œëŸ¬ìš´ ê³¡ì„ , í° ì•„ì´ì½˜
- **ì²­ì†Œë…„ ëŒ€ìƒ**: íŠ¸ë Œë””í•˜ê³  ì—­ë™ì ì¸ ìƒ‰ìƒ, í˜„ëŒ€ì  íƒ€ì´í¬ê·¸ëž˜í”¼
- **ì„±ì¸ ëŒ€ìƒ**: ì „ë¬¸ì ì´ê³  ì°¨ë¶„í•œ ìƒ‰ìƒ, ê¹”ë”í•œ ë ˆì´ì•„ì›ƒ
- **ì „ë¬¸ê°€ ëŒ€ìƒ**: ê³ ê¸‰ìŠ¤ëŸ½ê³  ì‹ ë¢°ê° ìžˆëŠ” ìƒ‰ìƒ, ì •êµí•œ ë””í…Œì¼

#### ì£¼ì œë³„ ì°½ì˜ì  íŠ¹í™”:
- **ê³¼í•™/ê¸°ìˆ **: ì‚¬ì´ë²„íŽ‘í¬ ë„¤ì˜¨ ê·¸ë¼ë””ì–¸íŠ¸, í™€ë¡œê·¸ëž˜í”½ ì´íŽ™íŠ¸, ê¸°í•˜í•™ íŒ¨í„´, ê¸€ë¦¬ì¹˜ íš¨ê³¼, ë¯¸ëž˜ì  ê¸€ëž˜ìŠ¤ëª¨í”¼ì¦˜
- **ì˜ˆìˆ /ì°½ìž‘**: ì•„ë¥´ëˆ„ë³´ ê³¡ì„ , ì›Œí„°ì»¬ëŸ¬ ë¸”ë Œë”©, ë¹„ëŒ€ì¹­ ê·¸ë¦¬ë“œ, ë¸ŒëŸ¬ì‹œ í…ìŠ¤ì²˜, ì¶”ìƒì  ë„í˜• ì¡°í•©, ìƒ‰ìƒ í­ë°œ íš¨ê³¼
- **ì—­ì‚¬/ì¸ë¬¸**: ë¹ˆí‹°ì§€ ì„¸ë¦¬í”„, ê³ ì „ ìž¥ì‹ íŒ¨í„´, íŽ˜ì´ì§€ ì—ì´ì§• íš¨ê³¼, ì–‘í”¼ì§€ í…ìŠ¤ì²˜, ìˆ˜ì±„í™” ë²ˆì§ íš¨ê³¼, ê¸ˆë°• ì•¡ì„¼íŠ¸
- **ì–¸ì–´/ë¬¸í•™**: íƒ€ì´í¬ê·¸ëž˜í”¼ ì•„íŠ¸, ê¸€ë¦¬í”„ ë””ìžì¸, ì±… íŽ˜ì´ì§€ ë„˜ê¹€ ì• ë‹ˆë©”ì´ì…˜, ìž‰í¬ í”Œë¡œìš° íš¨ê³¼, ì†ê¸€ì”¨ ìº˜ë¦¬ê·¸ëž˜í”¼

### 3. ê³µê°„ í™œìš© ì² í•™
- ê°€ë¡œ: 1600px ê³ ì •, ì„¸ë¡œ: ì½˜í…ì¸  ì–‘ì— ë”°ë¼ **ìžìœ ë¡­ê²Œ í™•ìž¥**
- **ê¸¸ì´ ì œí•œ ì—†ì´** ì™„ì „í•œ ì •ë³´ ì „ë‹¬ ìš°ì„ 
- **ì¶©ë¶„í•œ ê°„ê²©**ìœ¼ë¡œ ê°€ë…ì„± í™•ë³´
- ì„¹ì…˜ ê°„ **ì—¬ìœ ë¡œìš´ ì—¬ë°±** (60-80px)

### 4. í˜„ëŒ€ì  ë””ìžì¸ ì‹œìŠ¤í…œ (ìŠ¤í¬ë¡¤í˜•)
- **ê¸€ëž˜ìŠ¤ëª¨í”¼ì¦˜**: ë°˜íˆ¬ëª… ìš”ì†Œ, ë¸”ëŸ¬ ë°±ë“œë¡­, ì„œë¸Œí‹€ ê·¸ë¼ë””ì–¸íŠ¸
- **ë„¤ì˜¤ëª¨í”¼ì¦˜**: ì†Œí”„íŠ¸ ê·¸ë¦¼ìž, ì— ë³´ìŠ¤ë“œ ë²„íŠ¼, ë¯¸ë‹ˆë©€ í•˜ì´ë¼ì´íŠ¸
- **ê·¸ë¼ë””ì–¸íŠ¸ ë©”ì‰¬**: ìœ ê¸°ì  ìƒ‰ìƒ ë¸”ë Œë”©, ë…¸ì´ì¦ˆ í…ìŠ¤ì²˜ ì˜¤ë²„ë ˆì´
- **ë¸Œë¡œí° ê·¸ë¦¬ë“œ**: ë¹„ëŒ€ì¹­ ë ˆì´ì•„ì›ƒ, ì˜¤í”„ì…‹ ìš”ì†Œ, ë‹¤ì´ë‚˜ë¯¹ ì—¬ë°±
- **ëª¨ì…˜ ê·¸ëž˜í”½**: íŒ¨ëŸ´ëž™ìŠ¤ ìŠ¤í¬ë¡¤ë§, ëª¨í´ë§ ì• ë‹ˆë©”ì´ì…˜, íŒŒí‹°í´ ì‹œìŠ¤í…œ

ë‹¤ìŒ í•­ëª©ë“¤ì„ JSON í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì£¼ì„¸ìš”:

{
  "moodAndTone": "í”„ë¡œì íŠ¸ ì£¼ì œ(${projectData.pages.map(p => p.topic).join(', ')})ì™€ ëŒ€ìƒ(${projectData.targetAudience})ì— ìµœì í™”ëœ 4ê°œ í˜•ìš©ì‚¬ (ì˜ˆ: ì—¬ìœ ë¡œìš´, íƒí—˜ì ì¸, ëª°ìž…ê° ìžˆëŠ”, ì¹œê·¼í•œ)",
  
  "colorPalette": {
    "primary": "#HEXì½”ë“œ (í”„ë¡œì íŠ¸ ì£¼ì œì— ë§žëŠ” ë©”ì¸ ìƒ‰ìƒ - ê¸´ ìŠ¤í¬ë¡¤ì—ë„ í”¼ë¡œê° ì—†ë„ë¡, ìµœì†Œ 7:1 í…ìŠ¤íŠ¸ ëŒ€ë¹„ìœ¨)",
    "secondary": "#HEXì½”ë“œ (ëŒ€ìƒ ì—°ë ¹ì— ì í•©í•œ ë³´ì¡° ìƒ‰ìƒ, primaryì™€ ì¡°í™”ë¡­ë˜ ì¶©ë¶„ížˆ êµ¬ë¶„)",
    "accent": "#HEXì½”ë“œ (ìŠ¤í¬ë¡¤ ì§„í–‰ í‘œì‹œìš© ê°•ì¡°ìƒ‰, ì‹œì„ ì„ ë„ëŠ” ìƒìƒí•œ ìƒ‰ìƒ)",
    "text": "#HEXì½”ë“œ (ìž¥ì‹œê°„ ì½ê¸°ì— ìµœì í™”ëœ í…ìŠ¤íŠ¸ ìƒ‰ìƒ, ë°°ê²½ ëŒ€ë¹„ ìµœì†Œ 7:1)",
    "background": "#HEXì½”ë“œ (ì•„ì´ë³´í˜¸ì™€ ì§‘ì¤‘ë ¥ì„ ìœ„í•œ ë”°ëœ»í•˜ê³  íŽ¸ì•ˆí•œ ë°°ê²½ìƒ‰)"
  },
  
  "typography": {
    "headingFont": "ëŒ€ìƒ(${projectData.targetAudience})ê³¼ ì£¼ì œì— ë§žëŠ” ì œëª©ìš© í°íŠ¸ (ê³„ì¸µ êµ¬ì¡° ëª…í™•)",
    "bodyFont": "ê¸´ í…ìŠ¤íŠ¸ ì½ê¸°ìš© ìµœì í™” í°íŠ¸ (ê°€ë…ì„± ìµœìš°ì„ )",
    "baseSize": "ìŠ¤í¬ë¡¤ í™˜ê²½ ìµœì  í¬ê¸° (ìµœì†Œ 18px, ëŒ€ìƒ ì—°ë ¹ ê³ ë ¤)"
  },
  
  "componentStyle": "${projectData.projectTitle} í”„ë¡œì íŠ¸ì™€ ${projectData.targetAudience} ëŒ€ìƒì— íŠ¹í™”ëœ ì°½ì˜ì  ìŠ¤í¬ë¡¤í˜• UI: ê¸€ëž˜ìŠ¤ëª¨í”¼ì¦˜ ì¹´ë“œ, ë¹„ëŒ€ì¹­ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ, ëª¨í´ë§ ë²„íŠ¼, ê·¸ë¼ë””ì–¸íŠ¸ ë©”ì‰¬ ë°°ê²½, íŒŒí‹°í´ ì• ë‹ˆë©”ì´ì…˜, í™€ë¡œê·¸ëž˜í”½ í…Œë‘ë¦¬, 3D ë³€í™˜ íš¨ê³¼. ì£¼ì œë³„ ë…ì°½ì  ë””ìžì¸ ì‹œìŠ¤í…œ ì ìš©í•˜ì—¬ ì‹œê°ì  ìž„íŒ©íŠ¸ ê·¹ëŒ€í™” (250ìž ì´ë‚´)"
}

**ìŠ¤í¬ë¡¤í˜• íŠ¹í™” ìš”êµ¬ì‚¬í•­:**
1. ê¸´ ìŠ¤í¬ë¡¤ì—ë„ **í”¼ë¡œê° ì—†ëŠ”** ìƒ‰ìƒ ì„ íƒ (ëŒ€ìƒ ì—°ë ¹ ê³ ë ¤)
2. ì„¹ì…˜ êµ¬ë¶„ì´ **ìžì—°ìŠ¤ëŸ½ê²Œ** ë³´ì´ëŠ” ë””ìžì¸
3. ìŠ¤í¬ë¡¤ ì§„í–‰ ìƒí™©ì„ **ì‹œê°ì ìœ¼ë¡œ ì•ˆë‚´**í•˜ëŠ” ìš”ì†Œ
4. ëª¨ë°”ì¼ í™˜ê²½ì—ì„œë„ **íŽ¸ì•ˆí•œ** ìŠ¤í¬ë¡¤ ê²½í—˜
5. **ë°°ê²½ ëŒ€ë¹„ í…ìŠ¤íŠ¸ ê°€ì‹œì„± 7:1 ì´ìƒ** ë³´ìž¥ (ì œëª©, ë³¸ë¬¸ ëª¨ë‘)
6. í”„ë¡œì íŠ¸ ì£¼ì œ(${projectData.pages.map(p => p.topic).join(', ')})ì— ë§žëŠ” **êµ¬ì²´ì  ë¶„ìœ„ê¸°ì™€ í˜•íƒœ**
7. ëŒ€ìƒ(${projectData.targetAudience})ì˜ íŠ¹ì„±ì„ ë°˜ì˜í•œ **ë§žì¶¤í˜• ë””ìžì¸**
8. JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ê³  ë‹¤ë¥¸ ì„¤ëª…ì€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”
    `;
  }

  private buildFixedPrompt(projectData: ProjectData): string {
    return `
ë‹¹ì‹ ì€ êµìœ¡ ì½˜í…ì¸  ë””ìžì¸ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤. 
ðŸ“ **ê³ ì • í¬ê¸° ë ˆì´ì•„ì›ƒ**ì„ ìœ„í•œ ë¹„ì£¼ì–¼ ì•„ì´ë´í‹°í‹°ë¥¼ ë””ìžì¸í•´ì£¼ì„¸ìš”.

## í”„ë¡œì íŠ¸ ì •ë³´
- í”„ë¡œì íŠ¸ëª…: ${projectData.projectTitle}
- ëŒ€ìƒ í•™ìŠµìž: ${projectData.targetAudience}
- íŽ˜ì´ì§€ ì£¼ì œ: ${projectData.pages.map(p => p.topic).join(', ')}
- ì½˜í…ì¸  ëª¨ë“œ: ${projectData.contentMode === 'enhanced' ? 'AI ë³´ê°•' : 'ì›ë³¸ ìœ ì§€'}
- ì‚¬ìš©ìž ì œì•ˆ: ${projectData.suggestions || 'ì—†ìŒ'}

## ðŸ“ ê³ ì • í¬ê¸° ë ˆì´ì•„ì›ƒ ì „ìš© ë””ìžì¸ ì›ì¹™

**ì •í™•ížˆ 1600x1000px í”„ë ˆìž„ ì•ˆì—ì„œ ìµœëŒ€ íš¨ìœ¨ì„ ë‹¬ì„±í•©ë‹ˆë‹¤.**

### 1. ê°€ë…ì„± ìµœìš°ì„  ì»¬ëŸ¬ ì‹œìŠ¤í…œ (ê³ ì •í˜• íŠ¹í™”)
- **ë°°ê²½ ëŒ€ë¹„ ì œëª©**: ìµœì†Œ 7:1 ëŒ€ë¹„ìœ¨ë¡œ ì¦‰ì‹œ ì¸ì‹ ê°€ëŠ¥
- **í…ìŠ¤íŠ¸ ê³„ì¸µ êµ¬ì¡°**: Primary(ì œëª©) â†’ Secondary(ë¶€ì œëª©) â†’ Text(ë³¸ë¬¸) ëª…í™•í•œ ëŒ€ë¹„
- **ì œí•œëœ ê³µê°„ ìµœì í™”**: ê°•ë ¬í•œ ëŒ€ë¹„ë¡œ ì •ë³´ ì „ë‹¬ë ¥ ê·¹ëŒ€í™”
- **ìƒ‰ìƒ íš¨ìœ¨ì„±**: ì ì€ ìƒ‰ìƒìœ¼ë¡œ ìµœëŒ€ ìž„íŒ©íŠ¸ (3-4ìƒ‰ ì´ë‚´)

### 2. í”„ë¡œì íŠ¸ ë§žì¶¤í˜• ë””ìžì¸ ë¶„ìœ„ê¸° (ê³ ì •í˜• íŠ¹í™”)
#### ëŒ€ìƒë³„ íŠ¹í™”:
- **ì–´ë¦°ì´ ëŒ€ìƒ**: ë°ê³  í™œê¸°ì°¬ ìƒ‰ìƒ, í° ì•„ì´ì½˜, ê°„ë‹¨í•œ êµ¬ì„±
- **ì²­ì†Œë…„ ëŒ€ìƒ**: ëª¨ë˜í•˜ê³  ì—­ë™ì ì¸ ìƒ‰ìƒ, íŠ¸ë Œë””í•œ UI ìš”ì†Œ
- **ì„±ì¸ ëŒ€ìƒ**: ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìžˆëŠ” ìƒ‰ìƒ, íš¨ìœ¨ì  ë ˆì´ì•„ì›ƒ
- **ì „ë¬¸ê°€ ëŒ€ìƒ**: ê³ ê¸‰ìŠ¤ëŸ½ê³  ì°¨ë¶„í•œ ìƒ‰ìƒ, ì •ë³´ ë°€ë„ ìµœì í™”

#### ì£¼ì œë³„ ì°½ì˜ì  íŠ¹í™” (ê³ ì •í˜•):
- **ê³¼í•™/ê¸°ìˆ **: ë„¤ì˜¤ëª¨í”¼ì¦˜, ì‚¬ì´ë²„ê·¸ë¦¬ë“œ íŒ¨í„´, í™€ë¡œê·¸ëž¨ í…Œë‘ë¦¬, LED ê¸€ë¡œìš° íš¨ê³¼, ë©”íƒˆë¦­ ê·¸ë¼ë””ì–¸íŠ¸
- **ì˜ˆìˆ /ì°½ìž‘**: ë¸Œë¡œí° ê·¸ë¦¬ë“œ, ìƒ‰ìƒ ë¸”ë¦¬ë”©, ì¶”ìƒ ë„í˜• ë§ˆìŠ¤í‚¹, ë¸ŒëŸ¬ì‹œ ìŠ¤íŠ¸ë¡œí¬ í…Œë‘ë¦¬, ì»¬ëŸ¬ ìŠ¤í”Œëž˜ì‹œ
- **ì—­ì‚¬/ì¸ë¬¸**: íŽ˜ì´í¼ í…ìŠ¤ì²˜, íŽœ ìž‰í¬ íš¨ê³¼, ê³ ë”• ìž¥ì‹ í”„ë ˆìž„, ë§ˆë¸”ë§ íŒ¨í„´, ê³¨ë“œ í¬ì¼ ê°•ì¡°
- **ì–¸ì–´/ë¬¸í•™**: íƒ€ì´í¬ê·¸ëž˜í”¼ ë ˆì´ì–´ë§, ë¶ ìŠ¤íŒŒì¸ ë””ìžì¸, ì†ê¸€ì”¨ ì˜¤ë²„ë ˆì´, íŽ˜ì´ì§€ ì½”ë„ˆ í´ë”©

### 3. ê³µê°„ íš¨ìœ¨ ê·¹ëŒ€í™”
- **ì—„ê²©ížˆ ê³ ì •ëœ** 1600x1000px í”„ë ˆìž„
- **ì—¬ë°± ìµœì†Œí™”**ë¡œ ì½˜í…ì¸  ë°€ë„ ê·¹ëŒ€í™”  
- **ì••ì¶•ì  í‘œí˜„**ìœ¼ë¡œ í•µì‹¬ ì •ë³´ ì „ë‹¬
- ëª¨ë“  ìš”ì†Œê°€ **í•œ í™”ë©´ì— ì™„ê²°**

### 4. í˜„ëŒ€ì  ë””ìžì¸ ì‹œìŠ¤í…œ (ê³ ì •í˜•)
- **í´ë ˆì´ëª¨í”¼ì¦˜**: í”Œë¼ìŠ¤í‹± í‘œë©´ ì§ˆê°, ìž…ì²´ì  ê·¸ë¦¼ìž, ë©”íƒˆë¦­ í•˜ì´ë¼ì´íŠ¸
- **ë¸Œë£¨íƒˆë¦¬ì¦˜**: ê±°ì¹œ í…Œë‘ë¦¬, ì›ì‹œì  í°íŠ¸, ê³ ëŒ€ë¹„ ìƒ‰ìƒ ì¶©ëŒ
- **ê·¸ë¼ë””ì–¸íŠ¸ ë³´ë”**: ë¬´ì§€ê°œ í…Œë‘ë¦¬, í™€ë¡œê·¸ëž˜í”½ ì•„ì›ƒë¼ì¸, ë„¤ì˜¨ ê¸€ë¡œìš°
- **ê¸°í•˜í•™ì  ë§ˆìŠ¤í‚¹**: ë‹¤ê°í˜• í´ë¦¬í•‘, í”„ëž™íƒˆ íŒ¨í„´, ëª¨ìžì´í¬ íš¨ê³¼
- **ë ˆì´ì–´ë“œ ê¹Šì´**: Z-ì¸ë±ìŠ¤ í™œìš©, í”Œë¡œíŒ… ìš”ì†Œ, ë©€í‹° í”Œë ˆì¸ êµ¬ì„±

ë‹¤ìŒ í•­ëª©ë“¤ì„ JSON í˜•ì‹ìœ¼ë¡œ ì œê³µí•´ì£¼ì„¸ìš”:

{
  "moodAndTone": "í”„ë¡œì íŠ¸ ì£¼ì œ(${projectData.pages.map(p => p.topic).join(', ')})ì™€ ëŒ€ìƒ(${projectData.targetAudience})ì— ìµœì í™”ëœ ê³ ì •í˜•ì— ì í•©í•œ 4ê°œ í˜•ìš©ì‚¬ (ì˜ˆ: ëª…ë£Œí•œ, ì§‘ì¤‘ëœ, ìž„íŒ©íŠ¸ ìžˆëŠ”, íš¨ìœ¨ì ì¸)",
  
  "colorPalette": {
    "primary": "#HEXì½”ë“œ (í”„ë¡œì íŠ¸ ì£¼ì œì— ë§žëŠ” ê°•ë ¬í•œ ë©”ì¸ ìƒ‰ìƒ - ì¦‰ì‹œ ì‹œì„  ì§‘ì¤‘, ë°°ê²½ ëŒ€ë¹„ ìµœì†Œ 7:1)",
    "secondary": "#HEXì½”ë“œ (ëŒ€ìƒ ì—°ë ¹ì— ì í•©í•œ ëª…í™•í•œ ë³´ì¡° ìƒ‰ìƒ, primaryì™€ ê°•í•œ ëŒ€ë¹„)",
    "accent": "#HEXì½”ë“œ (í•µì‹¬ ì •ë³´ ê°•ì¡°ìš© ê³ ëŒ€ë¹„ ìƒ‰ìƒ, ì‹œì„ ì„ í™•ì‹¤ížˆ ë„ëŠ” ìƒ‰)",
    "text": "#HEXì½”ë“œ (ì œí•œ ê³µê°„ì—ì„œ ìµœê³  ê°€ë…ì„± í…ìŠ¤íŠ¸ ìƒ‰ìƒ, ë°°ê²½ ëŒ€ë¹„ ìµœì†Œ 7:1)",
    "background": "#HEXì½”ë“œ (ì½˜í…ì¸  ë°€ë„ ê³ ë ¤í•œ ê¹”ë”í•œ ë°°ê²½ìƒ‰, ëª¨ë“  í…ìŠ¤íŠ¸ì™€ 7:1 ëŒ€ë¹„)"
  },
  
  "typography": {
    "headingFont": "ëŒ€ìƒ(${projectData.targetAudience})ê³¼ ì£¼ì œì— ë§žëŠ” ê³ ì •í˜• ì œëª©ìš© í°íŠ¸ (ìž„íŒ©íŠ¸ì™€ ì••ì¶•ì„±)",
    "bodyFont": "ì œí•œ ê³µê°„ ìµœì í™” ë³¸ë¬¸ í°íŠ¸ (ë°€ë„ì™€ ê°€ë…ì„± ê· í˜•)",
    "baseSize": "ê³ ì • í”„ë ˆìž„ ìµœì  í¬ê¸° (ìµœì†Œ 16px, ê³µê°„ íš¨ìœ¨ ê³ ë ¤)"
  },
  
  "componentStyle": "${projectData.projectTitle} í”„ë¡œì íŠ¸ì™€ ${projectData.targetAudience} ëŒ€ìƒì— íŠ¹í™”ëœ ì°½ì˜ì  ê³ ì •í˜• UI: í´ë ˆì´ëª¨í”¼ì¦˜ ìš”ì†Œ, ë¸Œë£¨íƒˆë¦¬ì¦˜ íƒ€ì´í¬ê·¸ëž˜í”¼, ê·¸ë¼ë””ì–¸íŠ¸ ë³´ë”, ê¸°í•˜í•™ì  ë§ˆìŠ¤í‚¹, ë ˆì´ì–´ë“œ ê¹Šì´ê°, í™€ë¡œê·¸ëž˜í”½ í•˜ì´ë¼ì´íŠ¸, ë„¤ì˜¨ ê¸€ë¡œìš° ì•¡ì„¼íŠ¸. ì œí•œëœ ê³µê°„ì—ì„œ ìµœëŒ€ ì‹œê°ì  ìž„íŒ©íŠ¸ì™€ ì •ë³´ ì „ë‹¬ë ¥ ë‹¬ì„± (250ìž ì´ë‚´)"
}

**ê³ ì •í˜• íŠ¹í™” ìš”êµ¬ì‚¬í•­:**
1. ì œí•œëœ ê³µê°„ì—ì„œ **ìµœëŒ€ ì •ë³´ ì „ë‹¬ëŸ‰** ë‹¬ì„± (ëŒ€ìƒ ì—°ë ¹ ê³ ë ¤)
2. **ì¦‰ì„ì—ì„œ ì´í•´** ê°€ëŠ¥í•œ ì§ê´€ì  ë””ìžì¸
3. **í”½ì…€ ë‹¨ìœ„ ì •í™•ë„**ë¡œ ë ˆì´ì•„ì›ƒ ìµœì í™”
4. ìŠ¤í¬ë¡¤ ì—†ì´ **ì™„ê²°ëœ ê²½í—˜** ì œê³µ
5. **ë°°ê²½ ëŒ€ë¹„ ëª¨ë“  í…ìŠ¤íŠ¸ 7:1 ì´ìƒ** ë³´ìž¥ (ì œëª©, ë³¸ë¬¸, ë¼ë²¨ ëª¨ë‘)
6. í”„ë¡œì íŠ¸ ì£¼ì œ(${projectData.pages.map(p => p.topic).join(', ')})ì— ë§žëŠ” **êµ¬ì²´ì  ë¶„ìœ„ê¸°ì™€ í˜•íƒœ**
7. ëŒ€ìƒ(${projectData.targetAudience})ì˜ íŠ¹ì„±ì„ ë°˜ì˜í•œ **íš¨ìœ¨ì  ë§žì¶¤í˜• ë””ìžì¸**
8. JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ê³  ë‹¤ë¥¸ ì„¤ëª…ì€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”
    `;
  }

  private mapToneFromMood(moodAndTone: string): 'professional' | 'friendly' | 'playful' {
    const mood = moodAndTone.toLowerCase();
    
    if (mood.includes('ì „ë¬¸ì ') || mood.includes('ì •í™•í•œ') || mood.includes('ì²´ê³„ì ')) {
      return 'professional';
    } else if (mood.includes('ìž¬ë¯¸') || mood.includes('ê²Œìž„') || mood.includes('í™œê¸°') || mood.includes('ë°ì€')) {
      return 'playful';
    } else {
      return 'friendly';
    }
  }

  // ìƒ‰ìƒ ì ‘ê·¼ì„± ê²€ì¦
  validateColorContrast(backgroundColor: string, textColor: string): boolean {
    // ê°„ë‹¨í•œ ëŒ€ë¹„ìœ¨ ê³„ì‚° (ì‹¤ì œë¡œëŠ” ë” ë³µìž¡í•œ WCAG ê³„ì‚°ì´ í•„ìš”)
    const bgLuminance = this.getLuminance(backgroundColor);
    const textLuminance = this.getLuminance(textColor);
    
    const contrastRatio = (Math.max(bgLuminance, textLuminance) + 0.05) / 
                         (Math.min(bgLuminance, textLuminance) + 0.05);
    
    return contrastRatio >= 4.5; // WCAG AA ê¸°ì¤€
  }

  private getLuminance(hex: string): number {
    // HEX to RGB
    const r = parseInt(hex.slice(1, 3), 16) / 255;
    const g = parseInt(hex.slice(3, 5), 16) / 255;
    const b = parseInt(hex.slice(5, 7), 16) / 255;
    
    // Relative luminance
    const rs = r <= 0.03928 ? r / 12.92 : Math.pow((r + 0.055) / 1.055, 2.4);
    const gs = g <= 0.03928 ? g / 12.92 : Math.pow((g + 0.055) / 1.055, 2.4);
    const bs = b <= 0.03928 ? b / 12.92 : Math.pow((b + 0.055) / 1.055, 2.4);
    
    return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
  }

  // ë¯¸ë¦¬ ì •ì˜ëœ ì•ˆì „í•œ ìƒ‰ìƒ ì¡°í•©ë“¤
  getPresetColorPalettes() {
    return [
      {
        name: 'êµìœ¡ìš© ë¸”ë£¨',
        colorPalette: {
          primary: '#3e88ff',
          secondary: '#10B981',
          accent: '#FBBF24',
          text: '#1F2937',
          background: '#FFFFFF'
        }
      },
      {
        name: 'ì¹œê·¼í•œ ê·¸ë¦°',
        colorPalette: {
          primary: '#10B981',
          secondary: '#3e88ff',
          accent: '#F59E0B',
          text: '#374151',
          background: '#F9FAFB'
        }
      },
      {
        name: 'í™œê¸°ì°¬ ì˜¤ë Œì§€',
        colorPalette: {
          primary: '#F59E0B',
          secondary: '#8B5CF6',
          accent: '#EF4444',
          text: '#1F2937',
          background: '#FFFBEB'
        }
      }
    ];
  }
}