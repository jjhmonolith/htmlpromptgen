# 📊 Step3 프롬프트 분석 및 개선 방안

## 📋 개요

이 문서는 사용자가 제시한 Step3 프롬프트와 현재 시스템의 프롬프트를 비교 분석하고, 개선이 필요한 부분을 식별한 결과를 정리합니다.

## 🎯 사용자 제시 프롬프트 원문

### 1. Fixed Layout (스크롤x 내용 그대로)

```
당신은 주어진 '비주얼 아이덴티티'를 바탕으로 교육 콘텐츠 레이아웃을 구성하는 전문 UI 디자이너입니다. 스크롤 없는 1600x1000px 화면에 들어갈 콘텐츠 레이아웃을 구성해주세요.

### 📌 콘텐츠 생성 방침
사용자가 제공한 페이지 주제의 내용만을 정확히 사용하여 레이아웃을 구성하세요. 추가적인 내용을 생성하지 마시고, 주어진 주제를 효과적으로 시각화하는 레이아웃과 디자인을 상세히 설명하세요. 레이아웃 구성, 섹션 배치, 시각적 요소의 배열은 자세히 서술하되, 내용은 주제에서 벗어나지 마세요.

### ✨ 비주얼 아이덴티티 (반드시 준수할 것)
- **분위기**: 밝은, 친근한, 귀여운, 호기심을 자극하는
- **핵심 디자인 원칙**: 콘텐츠의 중요도에 따라 시각적 계층(Visual Hierarchy)을 만드세요. 사용자의 시선이 자연스럽게 흐르도록 유도하고, 콘텐츠를 단순히 박스에 넣는 것이 아니라 콘텐츠 자체의 형태에 맞는 맞춤형 디자인을 하세요.

### 📍 전체 프로젝트 구성
페이지 1: '생각하는 기계' AI, 궁금하지 않니? - 학생들의 호기심을 유발하는 질문으로 시작하기
페이지 2: AI는 우리를 돕는 '똑똑한 컴퓨터 프로그램'이야 - AI의 핵심 개념을 쉬운 비유로 설명하기
페이지 3: 우리 주변의 AI 친구들 찾아보기! - 스마트폰 음성 비서, 유튜브 추천 등 일상 속 사례 제시
페이지 4: AI는 어떻게 똑똑해질까? '데이터' 먹고 쑥쑥! - '머신러닝'의 기본 원리를 고양이 사진 예시로 설명
페이지 5: 오늘 배운 AI 개념 퀴즈! - 간단한 O/X 퀴즈로 학습 내용 확인하며 마무리

### 📍 페이지 컨텍스트
- 첫 페이지입니다
- **현재 페이지 1: '생각하는 기계' AI, 궁금하지 않니? - 학생들의 호기심을 유발하는 질문으로 시작하기**
- 다음 페이지: AI는 우리를 돕는 '똑똑한 컴퓨터 프로그램'이야 - AI의 핵심 개념을 쉬운 비유로 설명하기

### 📜 핵심 규칙
1.  **자유 서술**: 정해진 키워드 없이, 개발자가 이해하기 쉽도록 레이아웃을 상세히 설명해주세요.
2.  **공간 최적화**: 콘텐츠를 화면에 효과적으로 배치하여 어색한 빈 공간이 생기지 않도록 하세요.
3.  **이미지 최소화**: 학습에 필수적인 이미지만 사용하고, 장식용 이미지는 피하세요.
4.  **구조화된 이미지 섹션**: 이미지가 필요한 경우 응답 끝에 다음 형식으로 분리해주세요:

=== REQUIRED IMAGES ===
1. filename: "1.png"
   description: "AI 이미지 생성을 위한 상세한 설명"
   placement: "이미지가 배치될 위치"

2. filename: "2.png"
   description: "AI 이미지 생성을 위한 상세한 설명"
   placement: "이미지가 배치될 위치"
=== END IMAGES ===

**중요**: filename은 반드시 "1.png", "2.png", "3.png" 형태의 **숫자.png** 형식만 사용하세요. 다른 이름 (예: hero.png, diagram.png)은 절대 사용하지 마세요!
5.  **페이지 간 연결성**: 이전/다음 페이지와의 자연스러운 흐름을 고려하세요.
6.  **전체 일관성**: 프로젝트 전체의 흐름과 일관성을 유지하면서 현재 페이지의 특색을 살려주세요.

### 🚫 절대 금지 사항
- **페이지 네비게이션 금지**: 절대로 페이지 간 이동 버튼, 링크, 네비게이션 메뉴를 만들지 마세요. 각 페이지는 완전히 독립적인 HTML 파일입니다.
- **페이지 번호 표시 금지**: "1/5", "다음", "이전" 같은 페이지 표시나 버튼을 절대 만들지 마세요.
- **최소 폰트 크기**: 모든 텍스트는 반드시 18pt 이상으로 설정하세요. 본문은 18-20pt, 제목은 24pt 이상을 권장합니다.
- **이미지 파일명 규칙**: 이미지 파일명은 "1.png", "2.png", "3.png"만 사용하세요. hero.png, diagram.png, icon.png 같은 설명적 이름은 금지입니다!

### 📝 프로젝트 정보
- 프로젝트: AI 리터러시 첫걸음
- 대상: AI에 대해 처음 배우는 중학생
- 사용자 추가 제안사항: 중학생 눈높이에 맞춰 친근한 말투와 귀여운 아이콘을 사용해주세요. 전체적으로 밝고 긍정적인 느낌을 원해요.

이제 위의 가이드라인에 맞춰 페이지 레이아웃을 상세히 서술해주세요. 반드시 레이아웃 구조와 디자인을 구체적으로 설명해야 합니다.

⚠️ **파일명 규칙 재확인**: 이미지 파일명은 절대 "1.png", "2.png", "3.png" 외에는 사용하지 마세요.
   - ✅ 올바른 예: "1.png", "2.png"
   - ❌ 잘못된 예: "hero.png", "diagram.png", "main-image.png", "icon.png"
```

### 2. Scrollable Layout (스크롤o 내용 AI 보강)

```
당신은 주어진 '비주얼 아이덴티티'를 바탕으로 교육 콘텐츠 레이아웃을 구성하는 전문 UI 디자이너입니다. 가로 1600px 고정, 세로는 콘텐츠에 맞게 자유롭게 확장되는 스크롤 가능한 레이아웃을 구성해주세요.

### 📍 콘텐츠 생성 방침
제공된 페이지 주제를 바탕으로 창의적으로 내용을 보강하고 확장하여 풍부한 교육 콘텐츠를 만드세요. 학습자의 이해를 돕는 추가 설명, 예시, 시각 자료 등을 자유롭게 제안하세요.

### ✨ 비주얼 아이덴티티 (반드시 준수할 것)
- **분위기**: 밝은, 친근한, 호기심 가득한, 귀여운
- **핵심 디자인 원칙**: 콘텐츠의 중요도에 따라 시각적 계층(Visual Hierarchy)을 만드세요. 사용자의 시선이 자연스럽게 흐르도록 유도하고, 콘텐츠를 단순히 박스에 넣는 것이 아니라 콘텐츠 자체의 형태에 맞는 맞춤형 디자인을 하세요.

### 📍 전체 프로젝트 구성
페이지 1: '생각하는 기계' AI, 궁금하지 않니? - 학생들의 호기심을 유발하는 질문으로 시작하기
페이지 2: AI는 우리를 돕는 '똑똑한 컴퓨터 프로그램'이야 - AI의 핵심 개념을 쉬운 비유로 설명하기
페이지 3: 우리 주변의 AI 친구들 찾아보기! - 스마트폰 음성 비서, 유튜브 추천 등 일상 속 사례 제시
페이지 4: AI는 어떻게 똑똑해질까? '데이터' 먹고 쑥쑥! - '머신러닝'의 기본 원리를 고양이 사진 예시로 설명
페이지 5: 오늘 배운 AI 개념 퀴즈! - 간단한 O/X 퀴즈로 학습 내용 확인하며 마무리

### 📍 페이지 컨텍스트
- 첫 페이지입니다
- **현재 페이지 1: '생각하는 기계' AI, 궁금하지 않니? - 학생들의 호기심을 유발하는 질문으로 시작하기**
- 다음 페이지: AI는 우리를 돕는 '똑똑한 컴퓨터 프로그램'이야 - AI의 핵심 개념을 쉬운 비유로 설명하기

### 📜 핵심 규칙
1.  **자유 서술**: 정해진 키워드 없이, 개발자가 이해하기 쉽도록 레이아웃을 상세히 설명해주세요.
2.  **콘텐츠 우선**: 콘텐츠의 완전한 전달을 우선시하고, 적절한 여백으로 가독성을 확보하세요.
3.  **이미지 최소화**: 학습에 필수적인 이미지만 사용하고, 장식용 이미지는 피하세요.
4.  **구조화된 이미지 섹션**: 이미지가 필요한 경우 응답 끝에 다음 형식으로 분리해주세요:

=== REQUIRED IMAGES ===
1. filename: "1.png"
   description: "AI 이미지 생성을 위한 상세한 설명"
   placement: "이미지가 배치될 위치"

2. filename: "2.png"
   description: "AI 이미지 생성을 위한 상세한 설명"
   placement: "이미지가 배치될 위치"
=== END IMAGES ===

**중요**: filename은 반드시 "1.png", "2.png", "3.png" 형태의 **숫자.png** 형식만 사용하세요. 다른 이름 (예: hero.png, diagram.png)은 절대 사용하지 마세요!
5.  **페이지 간 연결성**: 이전/다음 페이지와의 자연스러운 흐름을 고려하세요.
6.  **전체 일관성**: 프로젝트 전체의 흐름과 일관성을 유지하면서 현재 페이지의 특색을 살려주세요.

### 🚫 절대 금지 사항
- **페이지 네비게이션 금지**: 절대로 페이지 간 이동 버튼, 링크, 네비게이션 메뉴를 만들지 마세요. 각 페이지는 완전히 독립적인 HTML 파일입니다.
- **페이지 번호 표시 금지**: "1/5", "다음", "이전" 같은 페이지 표시나 버튼을 절대 만들지 마세요.
- **최소 폰트 크기**: 모든 텍스트는 반드시 18pt 이상으로 설정하세요. 본문은 18-20pt, 제목은 24pt 이상을 권장합니다.
- **이미지 파일명 규칙**: 이미지 파일명은 "1.png", "2.png", "3.png"만 사용하세요. hero.png, diagram.png, icon.png 같은 설명적 이름은 금지입니다!

### 📝 프로젝트 정보
- 프로젝트: AI 리터러시 첫걸음
- 대상: AI에 대해 처음 배우는 중학생
- 사용자 추가 제안사항: 중학생 눈높이에 맞춰 친근한 말투와 귀여운 아이콘을 사용해주세요. 전체적으로 밝고 긍정적인 느낌을 원해요.

이제 위의 가이드라인에 맞춰 페이지 레이아웃을 상세히 서술해주세요. 반드시 레이아웃 구조와 디자인을 구체적으로 설명해야 합니다.

⚠️ **파일명 규칙 재확인**: 이미지 파일명은 절대 "1.png", "2.png", "3.png" 외에는 사용하지 마세요.
   - ✅ 올바른 예: "1.png", "2.png"
   - ❌ 잘못된 예: "hero.png", "diagram.png", "main-image.png", "icon.png"
```

## 📊 레이아웃/콘텐츠 설정값 분석

### Layout Mode 분석

| 설정 | Fixed Layout | Scrollable Layout |
|------|-------------|-------------------|
| **화면 크기** | 1600x1000px (고정) | 1600px 너비 × 가변 높이 |
| **스크롤** | 없음 | 세로 스크롤 가능 |
| **공간 활용** | 제한된 공간 최적화 | 자유로운 콘텐츠 확장 |

### Content Mode 분석

| 설정 | Fixed (내용 그대로) | Scrollable (AI 보강) |
|------|-------------------|---------------------|
| **콘텐츠 방침** | 제공된 주제 내용만 정확히 사용 | 창의적 내용 보강 및 확장 |
| **추가 생성** | 금지 | 허용 (추가 설명, 예시, 시각 자료) |
| **레이아웃 초점** | 공간 최적화 | 콘텐츠 우선 |

## 🔍 현재 시스템과의 상세 비교

### 1. **프롬프트 구조 차이점**

#### 🔄 **현재 시스템 구조**
```typescript
1. 역할 정의 + 화면 크기 정의
2. Fixed/Scrollable별 제약사항 (매우 상세한 px 단위)
3. 비주얼 아이덴티티 (동적 삽입)
4. 프로젝트 컨텍스트 (동적 삽입)
5. 콘텐츠 분석 결과 (선택적)
6. 이미지 사용 가이드라인 (영문 프롬프트, 인라인 방식)
7. 핵심 규칙 (8개 항목)
8. 절대 금지 사항 (HTML/CSS 등 기술적 세부사항)
9. 콘텐츠 모드별 전략 (Enhanced/Restricted)
```

#### 🎯 **사용자 제시 구조**
```typescript
1. 역할 정의 + 화면 크기 정의
2. 콘텐츠 생성 방침 (단일 명확한 정책)
3. 비주얼 아이덴티티 (고정값)
4. 전체 프로젝트 구성 (구체적 예시)
5. 페이지 컨텍스트 (명시적)
6. 핵심 규칙 (6개 항목)
7. 절대 금지 사항 (교육 UX 중심)
8. 프로젝트 정보 (구체적)
9. 이미지 파일명 규칙 재확인
```

### 2. **콘텐츠 생성 방침의 차이**

#### 🔄 **현재 시스템 (복잡한 모드별 전략)**
```typescript
// Enhanced 모드
'### 🎯 Enhanced 모드 (AI 보강)
- **시각적 요소 추가**: 차트, 그래프, 다이어그램을 시각적 설명으로 설계
- 텍스트 요약하고 인포그래픽 형태로 구성 설명
- 여백과 타이포그래피로 시각적 완성도 향상
- 동적 요소와 인터랙션으로 학습 효과 극대화'

// Restricted 모드
'### 🎯 Restricted 모드 (그대로 사용)
- 주어진 콘텐츠만 사용, 추가 생성 금지
- 레이아웃 최적화에만 집중
- 긴 텍스트는 여러 컬럼으로 분할
- 기존 내용의 가독성 최대화'
```

#### 🎯 **사용자 제시 (명확하고 직접적)**
```typescript
// Fixed - 내용 그대로
'### 📌 콘텐츠 생성 방침
사용자가 제공한 페이지 주제의 내용만을 정확히 사용하여 레이아웃을 구성하세요.
추가적인 내용을 생성하지 마시고, 주어진 주제를 효과적으로 시각화하는 레이아웃과
디자인을 상세히 설명하세요.'

// Scrollable - AI 보강
'### 📍 콘텐츠 생성 방침
제공된 페이지 주제를 바탕으로 창의적으로 내용을 보강하고 확장하여 풍부한 교육 콘텐츠를
만드세요. 학습자의 이해를 돕는 추가 설명, 예시, 시각 자료 등을 자유롭게 제안하세요.'
```

### 3. **제약사항 설명의 차이**

#### 🔄 **현재 시스템 (매우 구체적)**
```typescript
'### 🔴 FIXED 레이아웃 필수 준수사항 (절대 위반 금지)
1. **전체 높이 제한**: 900px 이내 (여백 100px 제외)
2. **콘텐츠 예산**:
   - 제목: 최대 2줄 (80px)
   - 본문: 최대 20줄 (480px)
   - 이미지: 최대 2개, 각 150px 높이
   - 카드/박스: 최대 3개, 각 80px 높이
   - 여백 및 간격: 총 110px
3. **폰트 크기 고려 계산**:
   - 제목: 28pt = 37px + 여백 = 45px/줄
   - 본문: 18pt = 24px + 여백 = 30px/줄'
```

#### 🎯 **사용자 제시 (개념적)**
```typescript
// 제약사항 설명 없음 (단순한 화면 크기 언급만)
"스크롤 없는 1600x1000px 화면에 들어갈 콘텐츠 레이아웃을 구성해주세요."
```

### 4. **이미지 처리 방식의 근본적 차이**

#### 🔄 **현재 시스템 (인라인 방식)**
```typescript
// 프롬프트 내 인라인 이미지 지정
'**✅ 올바른 형식**: `[IMAGE: filename.png | Detailed English AI prompt]`'

// 파싱 로직
const pattern = /\[IMAGE:\s*([^|\]]+?)\s*\|\s*([^\]]+?)\]/g;
```

#### 🎯 **사용자 제시 (구조화된 섹션 방식)**
```typescript
// 응답 끝에 별도 섹션으로 분리
'=== REQUIRED IMAGES ===
1. filename: "1.png"
   description: "AI 이미지 생성을 위한 상세한 설명"
   placement: "이미지가 배치될 위치"
=== END IMAGES ==='

// 파일명 규칙: 숫자.png만 허용 (1.png, 2.png, 3.png)
```

### 5. **비주얼 아이덴티티 처리**

#### 🔄 **현재 시스템 (동적 삽입)**
```typescript
// 런타임에 실제 Step2 데이터 삽입
const visualIdentitySection = this.formatStep2VisualIdentityForPrompt(emotionalContext.visualIdentity);
// 결과: 실제 생성된 색상, 폰트, 컴포넌트 스타일
```

#### 🎯 **사용자 제시 (고정값 예시)**
```typescript
// 하드코딩된 고정값
'### ✨ 비주얼 아이덴티티 (반드시 준수할 것)
- **분위기**: 밝은, 친근한, 귀여운, 호기심을 자극하는
- **핵심 디자인 원칙**: 콘텐츠의 중요도에 따라 시각적 계층...'
```

### 6. **프로젝트 컨텍스트 제공**

#### 🔄 **현재 시스템 (동적 컨텍스트)**
```typescript
// 페이지 컨텍스트 동적 생성
const prevPageContext = pageIndex > 0
  ? `이전 페이지: ${projectData.pages[pageIndex - 1]?.topic || '없음'}`
  : '첫 번째 페이지입니다';
```

#### 🎯 **사용자 제시 (구체적 컨텍스트)**
```typescript
// 전체 프로젝트 구성을 명시적으로 나열
'### 📍 전체 프로젝트 구성
페이지 1: '생각하는 기계' AI, 궁금하지 않니? - 학생들의 호기심을 유발하는 질문으로 시작하기
페이지 2: AI는 우리를 돕는 '똑똑한 컴퓨터 프로그램'이야 - AI의 핵심 개념을 쉬운 비유로 설명하기'
```

## 🚨 현재 시스템의 문제점 발견

### 1. **아하모먼트 사용 문제**

#### ❌ **현재 시스템에서 아하모먼트 적극 활용**
```typescript
// educational-design.service.ts
${projectData.ahaMoments?.[pageIndex] ? `- **💡 이 페이지의 아하 모먼트**: ${projectData.ahaMoments[pageIndex]}` : ''}

// 전체 페이지 개요에서도 표시
const ahaMoment = projectData.ahaMoments?.[idx] ? ` | 💡 아하 모먼트: ${projectData.ahaMoments[idx]}` : '';
```

#### ✅ **사용자 제시 프롬프트에는 아하모먼트 없음**
사용자 프롬프트에는 아하모먼트에 대한 언급이 전혀 없음.

### 2. **페이지 데이터 구조 문제**

#### ❌ **현재 PageData 구조 (제목/내용 분리 안됨)**
```typescript
export interface PageData {
  id: string;
  pageNumber: number;
  topic: string;        // 제목만
  description?: string; // 내용이 명확히 분리되지 않음 (optional)
}

// 실제 사용
`${page.topic}${page.description ? ` (${page.description})` : ''}`
// → "AI의 기본 개념 (AI가 무엇인지 설명)" 형태
```

#### ✅ **사용자 제시 프롬프트의 구조**
```
페이지 1: '생각하는 기계' AI, 궁금하지 않니? - 학생들의 호기심을 유발하는 질문으로 시작하기
```
→ **제목**: '생각하는 기계' AI, 궁금하지 않니?
→ **내용**: 학생들의 호기심을 유발하는 질문으로 시작하기

## 🔧 필요한 수정사항 요약

### 1. **프롬프트 템플릿 교체**
- 현재: 복잡한 기술적 제약사항과 모드별 전략
- 변경: 명확하고 교육 중심적인 사용자 제시 프롬프트

### 2. **이미지 파싱 로직 변경**
```typescript
// 현재: 인라인 방식
const pattern = /\[IMAGE:\s*([^|\]]+?)\s*\|\s*([^\]]+?)\]/g;

// 변경: 구조화된 섹션 파싱
const parseStructuredImages = (response: string) => {
  const imageSection = response.match(/=== REQUIRED IMAGES ===(.*?)=== END IMAGES ===/s);
  // 새로운 파싱 로직 필요
}
```

### 3. **아하모먼트 제거**
- 프롬프트 생성 시 `projectData.ahaMoments` 관련 코드 모두 제거
- 사용자 제시 프롬프트와 일치시키기

### 4. **비주얼 아이덴티티 처리 방식 결정**
- 옵션 1: 사용자 제시처럼 고정값 사용
- 옵션 2: 동적 삽입 유지하되 사용자 제시 형태로 포맷팅

### 5. **페이지 데이터 구조 개선 검토**
- 현재: `topic` + `description` (애매한 구조)
- 검토: 제목과 내용의 명확한 분리 필요 여부

## 💡 권장 구현 방안

### **1단계: 프롬프트 템플릿 교체**
- 사용자 제시 프롬프트를 기본 템플릿으로 적용
- 동적 변수는 최소한으로 유지 (`${page.topic}`, `${projectData.projectTitle}` 등)

### **2단계: 이미지 파싱 로직 개선**
- 구조화된 이미지 섹션 파싱 함수 구현
- 숫자.png 파일명 규칙 강제

### **3단계: 아하모먼트 의존성 제거**
- 모든 아하모먼트 관련 코드 정리
- 프롬프트에서 아하모먼트 참조 제거

### **4단계: 검증 및 테스트**
- 기존 기능과의 호환성 확인
- Fixed/Scrollable 모드별 동작 테스트
- 파싱 정확도 검증

## 📈 기대 효과

### ✅ **개선 효과**
- **명확성**: 혼동 없는 직관적 지침
- **교육 중심**: 학습 효과에 집중된 접근
- **파싱 안정성**: 구조화된 이미지 섹션으로 오류 최소화
- **유지보수성**: 단순한 프롬프트 구조로 관리 용이

### ⚠️ **주의사항**
- 기존 동적 데이터 삽입 기능과의 조화 필요
- Step2 비주얼 아이덴티티 연동 방식 결정 필요
- 기존 파싱된 데이터와의 호환성 고려

---

**결론**: 사용자 제시 프롬프트는 현재 시스템보다 명확하고 교육 중심적이며, 파싱 안정성이 높습니다. 주요 수정사항은 프롬프트 템플릿 교체와 이미지 파싱 로직 변경이며, 이는 상대적으로 간단한 작업입니다.